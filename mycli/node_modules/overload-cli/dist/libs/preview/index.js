"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const express_1 = tslib_1.__importDefault(require("express"));
const utils_1 = require("../../utils");
const rawData_1 = tslib_1.__importDefault(require("./rawData"));
const { writeFileSync } = require('fs');
const { resolve } = require('path');
const LOGGER_TITLE = '启动本地预览';
const initialize = async (runtimeContent, skeletonConfig) => {
    (0, utils_1.loggerStart)(LOGGER_TITLE);
    let content = (0, rawData_1.default)();
    content = content.replace('<!-- rootID -->', skeletonConfig.rootID);
    content = content.replace('<!-- skeleton -->', runtimeContent);
    const previewTempFilePath = resolve(utils_1.PreviewTempDirname, 'index.html');
    await writeFileSync(previewTempFilePath, content);
    const app = (0, express_1.default)();
    app.use(express_1.default.static(utils_1.PreviewTempDirname));
    app.listen(3333);
    console.log('本地进程启动成功，请使用以下地址进行访问预览...');
    skeletonConfig.routes.forEach((routeConfig) => {
        console.log((0, utils_1.concatOriginUrl)('http://localhost:3333', routeConfig.path, skeletonConfig.routeMode));
    });
    return true;
};
exports.default = { initialize };
